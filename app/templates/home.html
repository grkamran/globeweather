{% extends "base.html" %}
{% block title %}GlobeWeather{% endblock %}

{% block content %}
<div class="layout">

  <div class="topbar">
    <div class="brand">
      <button class="profilebtn" id="menuBtn" type="button" aria-label="Menu">
        <div class="logo"></div>
      </button>

      <b id="brandTitle">Weather</b>

      <!-- MENU -->
      <div class="menu" id="menu">
        <div class="menu-panels" id="menuPanels">

          <div class="menu-panel is-active" id="menuMain">
            <div class="menu-title" id="menuTitle">Menu</div>

            <div class="menu-item" id="menuLanguage">
              <div class="menu-left">
                <div class="menu-ico">üåê</div>
                <div class="menu-meta">
                  <b id="langTitle">Language</b>
                  <span id="langSubtitle">Change UI language</span>
                </div>
              </div>
              <div class="menu-right" id="openText1">Open</div>
            </div>

            <div class="menu-item" id="menuContacts">
              <div class="menu-left">
                <div class="menu-ico">üì©</div>
                <div class="menu-meta">
                  <b id="contactsTitle">Contacts</b>
                  <span id="contactsSubtitle">Contact support</span>
                </div>
              </div>
              <div class="menu-right" id="openText2">Open</div>
            </div>
          </div>

          <div class="menu-panel" id="menuContactsPanel">
            <div class="menu-title" id="contactsPanelTitle">Contacts</div>

            <div class="menu-item" id="openEmail">
              <div class="menu-left">
                <div class="menu-ico">‚úâÔ∏è</div>
                <div class="menu-meta">
                  <b id="emailTitle">Email</b>
                  <span>kkaraev1@stu.vistula.edu.pl</span>
                </div>
              </div>
              <div class="menu-right" id="openText3">Open</div>
            </div>

            <div class="menu-item" id="openInsta">
              <div class="menu-left">
                <div class="menu-ico">üì∑</div>
                <div class="menu-meta">
                  <b id="instaTitle">Instagram</b>
                  <span>@grkamran</span>
                </div>
              </div>
              <div class="menu-right" id="openText4">Open</div>
            </div>

            <button class="menu-back" id="backToMenu1" type="button">‚Üê Back</button>
          </div>

          <div class="menu-panel" id="menuLanguagePanel">
            <div class="menu-title" id="languagePanelTitle">Choose language</div>

            <div class="menu-item" data-lang="en">
              <div class="menu-left">
                <div class="menu-ico">üá¨üáß</div>
                <div class="menu-meta">
                  <b>English</b>
                  <span>EN</span>
                </div>
              </div>
              <div class="menu-right" id="selectText1">Select</div>
            </div>

            <div class="menu-item" data-lang="ru">
              <div class="menu-left">
                <div class="menu-ico">üá∑üá∫</div>
                <div class="menu-meta">
                  <b>–†—É—Å—Å–∫–∏–π</b>
                  <span>RU</span>
                </div>
              </div>
              <div class="menu-right" id="selectText2">Select</div>
            </div>

            <div class="menu-item" data-lang="tr">
              <div class="menu-left">
                <div class="menu-ico">üáπüá∑</div>
                <div class="menu-meta">
                  <b>T√ºrk√ße</b>
                  <span>TR</span>
                </div>
              </div>
              <div class="menu-right" id="selectText3">Select</div>
            </div>

            <div class="menu-item" data-lang="uk">
              <div class="menu-left">
                <div class="menu-ico">üá∫üá¶</div>
                <div class="menu-meta">
                  <b>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</b>
                  <span>UK</span>
                </div>
              </div>
              <div class="menu-right" id="selectText4">Select</div>
            </div>

            <div class="menu-item" data-lang="pl">
              <div class="menu-left">
                <div class="menu-ico">üáµüá±</div>
                <div class="menu-meta">
                  <b>Polski</b>
                  <span>PL</span>
                </div>
              </div>
              <div class="menu-right" id="selectText5">Select</div>
            </div>

            <button class="menu-back" id="backToMenu2" type="button">‚Üê Back</button>
          </div>

        </div>
      </div>

      <div class="menu-overlay" id="menuOverlay"></div>
    </div>

    <!-- Search -->
    <div class="searchwrap">
      <input id="q" placeholder="Search city" autocomplete="off" />
      <div id="suggestBox" class="suggestbox" style="display:none;"></div>
    </div>

    <div class="statuspill" id="status">
      <span class="spin"></span>
      <span id="statusText">Ready</span>
    </div>
  </div>

  <section class="map-panel">
    <div id="map" aria-label="Map"></div>
  </section>

  <aside class="right">
    <div class="right-title">
      <b id="rightTitle">Next 4 days</b>
      <span class="tag" id="rtag">‚Äî</span>
    </div>

    <div class="citylist" id="daylist">
      <div class="citycard" id="placeholderCard">
        <div class="city-left">
          <div class="ico">üîé</div>
          <div class="city-meta">
            <b id="phTitle">Search a city</b>
            <span id="phSub">Type a city name and pick a suggestion to show the next 4 days forecast.</span>
          </div>
        </div>
        <div class="city-temp" style="opacity:.75;">‚Äî</div>
      </div>
    </div>
  </aside>

  <section class="bottom">
    <div class="bottom-head">
      <b id="sunTimeTitle">Sun ‚Ä¢ Time</b>
      <span class="tag" id="updated">‚Äî</span>
    </div>

    <div
      style="
        border:1px solid rgba(255,255,255,.14);
        background: rgba(255,255,255,.06);
        border-radius: 16px;
        padding: 10px;
        display:flex;
        flex-direction:column;
        gap:8px;
        overflow:hidden;
      "
    >
      <div style="display:flex; justify-content:space-between; gap:10px; align-items:center;">
        <span id="localTimeLabel" style="font-size:12px; color:rgba(255,255,255,.62); font-family: ui-monospace,monospace;">Local time</span>
        <b id="localtime" style="font-size:14px; letter-spacing:.2px;">‚Äî</b>
      </div>

      <div style="display:flex; justify-content:space-between; gap:10px; align-items:center;">
        <span id="sunriseLabel" style="font-size:12px; color:rgba(255,255,255,.62); font-family: ui-monospace,monospace;">Sunrise</span>
        <b id="sunrise" style="font-size:14px; letter-spacing:.2px;">‚Äî</b>
      </div>

      <div style="display:flex; justify-content:space-between; gap:10px; align-items:center;">
        <span id="sunsetLabel" style="font-size:12px; color:rgba(255,255,255,.62); font-family: ui-monospace,monospace;">Sunset</span>
        <b id="sunset" style="font-size:14px; letter-spacing:.2px;">‚Äî</b>
      </div>

      <div style="display:flex; justify-content:space-between; gap:10px; align-items:center;">
        <span id="dayLenLabel" style="font-size:12px; color:rgba(255,255,255,.62); font-family: ui-monospace,monospace;">Day length</span>
        <b id="daylen" style="font-size:14px; letter-spacing:.2px;">‚Äî</b>
      </div>
    </div>
  </section>

</div>

<!-- ‚úÖ DAY DETAILS (BOTTOM SHEET) -->
<div class="day-sheet-overlay" id="daySheetOverlay"></div>

<div class="day-sheet" id="daySheet" aria-hidden="true">
  <div class="day-sheet-handle"></div>

  <div class="day-sheet-head">
    <div style="min-width:0;">
      <b id="daySheetTitle" style="display:block; font-size:14px; letter-spacing:.2px; font-weight:950; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">‚Äî</b>
      <span id="daySheetSub" style="display:block; margin-top:4px; color:rgba(255,255,255,.62); font-family: ui-monospace,monospace; font-size:12px;">‚Äî</span>
    </div>

    <button class="day-sheet-close" id="daySheetClose" type="button">‚úï</button>
  </div>

  <div class="day-toggle">
    <button class="day-toggle-btn is-active" id="toggleActual" type="button">Actual</button>
    <button class="day-toggle-btn" id="toggleFeels" type="button">Feels like</button>
  </div>

  <div class="day-chart-wrap">
    <canvas id="dayChart" width="1000" height="320"></canvas>
  </div>

  <div class="hour-row" id="hourRow"></div>
</div>

<style>
  .menu-overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(2px);
    opacity: 0;
    pointer-events: none;
    transition: opacity .22s ease;
    z-index: 9998;
  }
  .menu-overlay.show{
    opacity: 1;
    pointer-events: auto;
  }

  .menu-panels{ position: relative; min-height: 160px; }
  .menu-panel{
    position: absolute; inset: 0;
    opacity: 0; transform: translateX(14px);
    pointer-events: none;
    transition: opacity .22s ease, transform .22s ease;
  }
  .menu-panel.is-active{
    opacity: 1; transform: translateX(0);
    pointer-events: auto;
    position: relative;
  }

  .citycard.card-appear{
    opacity: 0;
    transform: translateY(10px) scale(.99);
    animation: cardIn .42s cubic-bezier(.2,.9,.2,1) forwards;
    will-change: transform, opacity;
  }
  @keyframes cardIn{ to{ opacity:1; transform: translateY(0) scale(1); } }

  .suggestbox{
    position:absolute; top:52px; left:0; right:0;
    border-radius: 16px;
    border:1px solid rgba(255,255,255,.16);
    background: linear-gradient(180deg, rgba(16,20,52,.96), rgba(10,14,36,.92));
    backdrop-filter: blur(14px);
    box-shadow: 0 26px 90px rgba(0,0,0,.62);
    overflow:hidden;
    z-index: 99999;
    padding: 8px;
  }
  .sug-item{
    width:100%;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    border-radius: 14px;
    padding: 10px;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:10px;
    margin-bottom: 8px;
  }
  .sug-item:last-child{ margin-bottom: 0; }
  .sug-item:hover{ border-color: rgba(6,182,212,.35); box-shadow: 0 0 0 4px rgba(6,182,212,.10); }
  .sug-ico{
    width:34px;height:34px;border-radius: 14px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    display:flex; align-items:center; justify-content:center;
    flex:0 0 auto;
  }
  .sug-meta{ min-width:0; }
  .sug-meta b{
    display:block; font-size: 13px; font-weight: 950; letter-spacing:.2px;
    white-space: nowrap; overflow:hidden; text-overflow: ellipsis;
  }
  .sug-meta span{
    display:block; margin-top: 3px;
    color: rgba(255,255,255,.62);
    font-family: ui-monospace,monospace;
    font-size: 11px;
    white-space: nowrap; overflow:hidden; text-overflow: ellipsis;
  }
  .sug-empty{
    border:1px dashed rgba(255,255,255,.18);
    background: rgba(255,255,255,.04);
    border-radius: 14px;
    padding: 10px;
    color: rgba(255,255,255,.62);
    font-family: ui-monospace,monospace;
    font-size: 12px;
  }

  .citycard.is-clickable{ cursor:pointer; }
  .citycard.is-clickable:hover{
    border-color: rgba(6,182,212,.35);
    box-shadow: 0 0 0 4px rgba(6,182,212,.10), 0 14px 40px rgba(0,0,0,.30);
  }

  .day-sheet-overlay{
    position: fixed; inset: 0;
    background: rgba(0,0,0,.45);
    backdrop-filter: blur(2px);
    opacity: 0;
    pointer-events: none;
    transition: opacity .18s ease;
    z-index: 99990;
  }
  .day-sheet-overlay.show{ opacity: 1; pointer-events: auto; }

  .day-sheet{
    position: fixed;
    left: 50%;
    transform: translateX(-50%) translateY(110%);
    bottom: 14px;
    width: min(860px, calc(100vw - 24px));
    border-radius: 22px;
    border:1px solid rgba(255,255,255,.16);
    background: linear-gradient(180deg, rgba(16,20,52,.96), rgba(10,14,36,.92));
    box-shadow: 0 26px 90px rgba(0,0,0,.62);
    backdrop-filter: blur(14px);
    z-index: 99991;
    transition: transform .22s cubic-bezier(.2,.9,.2,1);
    padding: 12px;
  }
  .day-sheet.show{ transform: translateX(-50%) translateY(0%); }

  .day-sheet-handle{
    width: 56px; height: 5px; border-radius: 999px;
    background: rgba(255,255,255,.18);
    margin: 4px auto 10px;
  }
  .day-sheet-head{
    display:flex; align-items:flex-start; justify-content:space-between;
    gap: 10px; padding: 6px 4px 10px;
  }
  .day-sheet-close{
    width: 38px; height: 38px; border-radius: 999px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.92);
    cursor: pointer; font-size: 16px;
  }
  .day-sheet-close:active{ transform: scale(.98); }

  .day-toggle{ display:flex; gap: 10px; padding: 0 4px 10px; }
  .day-toggle-btn{
    flex:1; height: 40px; border-radius: 999px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.84);
    cursor: pointer;
    font-weight: 900; letter-spacing:.2px;
  }
  .day-toggle-btn.is-active{
    background: linear-gradient(135deg, rgba(124,58,237,.95), rgba(6,182,212,.88));
    border-color: rgba(255,255,255,.22);
    color: white;
  }

  .day-chart-wrap{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.05);
    border-radius: 18px;
    padding: 10px;
    overflow:hidden;
  }

  .hour-row{
    margin-top: 10px;
    display:flex;
    gap: 10px;
    overflow:auto;
    padding-bottom: 6px;
  }
  .hour-row::-webkit-scrollbar{ height: 10px; }
  .hour-row::-webkit-scrollbar-track{
    background: rgba(255,255,255,.04);
    border: 1px solid rgba(255,255,255,.10);
    border-radius: 999px;
  }
  .hour-row::-webkit-scrollbar-thumb{
    background: linear-gradient(180deg, rgba(124,58,237,.55), rgba(6,182,212,.45));
    border: 1px solid rgba(255,255,255,.16);
    border-radius: 999px;
  }

  .hour-card{
    flex: 0 0 auto;
    width: 128px;
    border-radius: 18px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    padding: 10px;
  }
  .hour-card b{ display:block; font-size: 13px; font-weight: 950; }
  .hour-card .mini{
    margin-top: 6px;
    font-size: 11px;
    color: rgba(255,255,255,.62);
    font-family: ui-monospace,monospace;
    line-height: 1.35;
  }
</style>

<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  // =========================
  // i18n
  // =========================
  const I18N = {
    en: {
      brandTitle: "Weather",
      menuTitle: "Menu",
      langTitle: "Language",
      langSubtitle: "Change UI language",
      contactsTitle: "Contacts",
      contactsSubtitle: "Contact support",
      open: "Open",
      select: "Select",
      back: "‚Üê Back",
      languagePanelTitle: "Choose language",
      searchPlaceholder: "Search city",
      ready: "Ready",
      typeCityName: "Type a city name",
      next4days: "Next 4 days",
      placeholderTitle: "Search a city",
      placeholderSub: "Type a city name and pick a suggestion to show the next 4 days forecast.",
      sunTime: "Sun ‚Ä¢ Time",
      localTime: "Local time",
      sunrise: "Sunrise",
      sunset: "Sunset",
      dayLen: "Day length",
      updated: "Updated",
      hum: "Hum",
      wind: "Wind",
      ms: "m/s",
      searching: "Searching‚Ä¶",
      done: "Done",
      errorPrefix: "Error: ",
      noForecastTitle: "No forecast",
      tryAnotherCity: "Try another city",
      noSuggestions: "No matches",
      details: "Details",
      pop: "Rain",
      actual: "Actual",
      feels: "Feels like",
    },
    ru: {
      brandTitle: "–ü–æ–≥–æ–¥–∞",
      menuTitle: "–ú–µ–Ω—é",
      langTitle: "–Ø–∑—ã–∫",
      langSubtitle: "–ò–∑–º–µ–Ω–∏—Ç—å —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",
      contactsTitle: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
      contactsSubtitle: "–°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π",
      open: "–û—Ç–∫—Ä—ã—Ç—å",
      select: "–í—ã–±—Ä–∞—Ç—å",
      back: "‚Üê –ù–∞–∑–∞–¥",
      languagePanelTitle: "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫",
      searchPlaceholder: "–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥",
      ready: "–ì–æ—Ç–æ–≤–æ",
      typeCityName: "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞",
      next4days: "–°–ª–µ–¥—É—é—â–∏–µ 4 –¥–Ω—è",
      placeholderTitle: "–ù–∞–π–¥–∏—Ç–µ –≥–æ—Ä–æ–¥",
      placeholderSub: "–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 4 –¥–Ω—è.",
      sunTime: "–°–æ–ª–Ω—Ü–µ ‚Ä¢ –í—Ä–µ–º—è",
      localTime: "–ú–µ—Å—Ç–Ω–æ–µ –≤—Ä–µ–º—è",
      sunrise: "–í–æ—Å—Ö–æ–¥",
      sunset: "–ó–∞–∫–∞—Ç",
      dayLen: "–î–ª–∏–Ω–∞ –¥–Ω—è",
      updated: "–û–±–Ω–æ–≤–ª–µ–Ω–æ",
      hum: "–í–ª–∞–∂–Ω.",
      wind: "–í–µ—Ç–µ—Ä",
      ms: "–º/—Å",
      searching: "–ü–æ–∏—Å–∫‚Ä¶",
      done: "–ì–æ—Ç–æ–≤–æ",
      errorPrefix: "–û—à–∏–±–∫–∞: ",
      noForecastTitle: "–ù–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞",
      tryAnotherCity: "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥",
      noSuggestions: "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
      details: "–î–µ—Ç–∞–ª–∏",
      pop: "–î–æ–∂–¥—å",
      actual: "–§–∞–∫—Ç–∏—á–µ—Å–∫–∏",
      feels: "–û—â—É—â. –∫–∞–∫",
    },
    tr: {
      brandTitle: "Hava",
      menuTitle: "Men√º",
      langTitle: "Dil",
      langSubtitle: "Aray√ºz dilini deƒüi≈ütir",
      contactsTitle: "ƒ∞leti≈üim",
      contactsSubtitle: "Destek ile ileti≈üime ge√ß",
      open: "A√ß",
      select: "Se√ß",
      back: "‚Üê Geri",
      languagePanelTitle: "Dil se√ßin",
      searchPlaceholder: "≈ûehir ara",
      ready: "Hazƒ±r",
      typeCityName: "Bir ≈üehir adƒ± yaz",
      next4days: "√ñn√ºm√ºzdeki 4 g√ºn",
      placeholderTitle: "≈ûehir ara",
      placeholderSub: "≈ûehir yaz ve √∂nerilerden se√ß. 4 g√ºnl√ºk tahmin g√∂sterilecek.",
      sunTime: "G√ºne≈ü ‚Ä¢ Saat",
      localTime: "Yerel saat",
      sunrise: "G√ºn doƒüumu",
      sunset: "G√ºn batƒ±mƒ±",
      dayLen: "G√ºn uzunluƒüu",
      updated: "G√ºncellendi",
      hum: "Nem",
      wind: "R√ºzgar",
      ms: "m/sn",
      searching: "Aranƒ±yor‚Ä¶",
      done: "Bitti",
      errorPrefix: "Hata: ",
      noForecastTitle: "Tahmin yok",
      tryAnotherCity: "Ba≈üka bir ≈üehir deneyin",
      noSuggestions: "Sonu√ß yok",
      details: "Detay",
      pop: "Yaƒüƒ±≈ü",
      actual: "Ger√ßek",
      feels: "Hissedilen",
    },
    uk: {
      brandTitle: "–ü–æ–≥–æ–¥–∞",
      menuTitle: "–ú–µ–Ω—é",
      langTitle: "–ú–æ–≤–∞",
      langSubtitle: "–ó–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É",
      contactsTitle: "–ö–æ–Ω—Ç–∞–∫—Ç–∏",
      contactsSubtitle: "–ó–≤‚Äô—è–∑–∞—Ç–∏—Å—è –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é",
      open: "–í—ñ–¥–∫—Ä–∏—Ç–∏",
      select: "–û–±—Ä–∞—Ç–∏",
      back: "‚Üê –ù–∞–∑–∞–¥",
      languagePanelTitle: "–û–±–µ—Ä—ñ—Ç—å –º–æ–≤—É",
      searchPlaceholder: "–ü–æ—à—É–∫ –º—ñ—Å—Ç–∞",
      ready: "–ì–æ—Ç–æ–≤–æ",
      typeCityName: "–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞",
      next4days: "–ù–∞—Å—Ç—É–ø–Ω—ñ 4 –¥–Ω—ñ",
      placeholderTitle: "–ó–Ω–∞–π–¥—ñ—Ç—å –º—ñ—Å—Ç–æ",
      placeholderSub: "–í–≤–µ–¥—ñ—Ç—å –º—ñ—Å—Ç–æ —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å –ø—ñ–¥–∫–∞–∑–∫—É. –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 4 –¥–Ω—ñ.",
      sunTime: "–°–æ–Ω—Ü–µ ‚Ä¢ –ß–∞—Å",
      localTime: "–ú—ñ—Å—Ü–µ–≤–∏–π —á–∞—Å",
      sunrise: "–°—Ö—ñ–¥",
      sunset: "–ó–∞—Ö—ñ–¥",
      dayLen: "–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –¥–Ω—è",
      updated: "–û–Ω–æ–≤–ª–µ–Ω–æ",
      hum: "–í–æ–ª–æ–≥.",
      wind: "–í—ñ—Ç–µ—Ä",
      ms: "–º/—Å",
      searching: "–ü–æ—à—É–∫‚Ä¶",
      done: "–ì–æ—Ç–æ–≤–æ",
      errorPrefix: "–ü–æ–º–∏–ª–∫–∞: ",
      noForecastTitle: "–ù–µ–º–∞—î –ø—Ä–æ–≥–Ω–æ–∑—É",
      tryAnotherCity: "–°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à–µ –º—ñ—Å—Ç–æ",
      noSuggestions: "–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ",
      details: "–î–µ—Ç–∞–ª—ñ",
      pop: "–î–æ—â",
      actual: "–§–∞–∫—Ç–∏—á–Ω–æ",
      feels: "–í—ñ–¥—á.",
    },
    pl: {
      brandTitle: "Pogoda",
      menuTitle: "Menu",
      langTitle: "Jƒôzyk",
      langSubtitle: "Zmie≈Ñ jƒôzyk interfejsu",
      contactsTitle: "Kontakt",
      contactsSubtitle: "Skontuj siƒô ze wsparciem",
      open: "Otw√≥rz",
      select: "Wybierz",
      back: "‚Üê Wr√≥ƒá",
      languagePanelTitle: "Wybierz jƒôzyk",
      searchPlaceholder: "Szukaj miasta",
      ready: "Gotowe",
      typeCityName: "Wpisz nazwƒô miasta",
      next4days: "Kolejne 4 dni",
      placeholderTitle: "Wyszukaj miasto",
      placeholderSub: "Wpisz miasto i wybierz podpowied≈∫, aby zobaczyƒá prognozƒô na 4 dni.",
      sunTime: "S≈Ço≈Ñce ‚Ä¢ Czas",
      localTime: "Czas lokalny",
      sunrise: "Wsch√≥d s≈Ço≈Ñca",
      sunset: "Zach√≥d s≈Ço≈Ñca",
      dayLen: "D≈Çugo≈õƒá dnia",
      updated: "Zaktualizowano",
      hum: "Wilg.",
      wind: "Wiatr",
      ms: "m/s",
      searching: "Szukanie‚Ä¶",
      done: "Gotowe",
      errorPrefix: "B≈ÇƒÖd: ",
      noForecastTitle: "Brak prognozy",
      tryAnotherCity: "Spr√≥buj inne miasto",
      noSuggestions: "Brak wynik√≥w",
      details: "Szczeg√≥≈Çy",
      pop: "Deszcz",
      actual: "Faktycznie",
      feels: "Odczuw.",
    },
  };

  function getLang(){ return localStorage.getItem("gw_lang") || "en"; }
  function t(key){
    const lang = getLang();
    return (I18N[lang] && I18N[lang][key]) ? I18N[lang][key] : (I18N.en[key] || key);
  }
  function localeForLang(lang){
    switch((lang || "en").toLowerCase()){
      case "ru": return "ru-RU";
      case "uk": return "uk-UA";
      case "tr": return "tr-TR";
      case "pl": return "pl-PL";
      default: return "en-US";
    }
  }

  function applyLang(lang){
    $("brandTitle").textContent = I18N[lang].brandTitle;
    $("q").placeholder = I18N[lang].searchPlaceholder;

    $("menuTitle").textContent = I18N[lang].menuTitle;
    $("langTitle").textContent = I18N[lang].langTitle;
    $("langSubtitle").textContent = I18N[lang].langSubtitle;
    $("contactsTitle").textContent = I18N[lang].contactsTitle;
    $("contactsSubtitle").textContent = I18N[lang].contactsSubtitle;

    $("openText1").textContent = I18N[lang].open;
    $("openText2").textContent = I18N[lang].open;
    $("openText3").textContent = I18N[lang].open;
    $("openText4").textContent = I18N[lang].open;

    $("selectText1").textContent = I18N[lang].select;
    $("selectText2").textContent = I18N[lang].select;
    $("selectText3").textContent = I18N[lang].select;
    $("selectText4").textContent = I18N[lang].select;
    $("selectText5").textContent = I18N[lang].select;

    $("contactsPanelTitle").textContent = I18N[lang].contactsTitle;
    $("emailTitle").textContent =
      (lang === "ru") ? "–ü–æ—á—Ç–∞" :
      (lang === "uk") ? "–ü–æ—à—Ç–∞" :
      (lang === "tr") ? "E-posta" :
      (lang === "pl") ? "Email" : "Email";
    $("instaTitle").textContent = "Instagram";

    $("backToMenu1").textContent = I18N[lang].back;
    $("backToMenu2").textContent = I18N[lang].back;
    $("languagePanelTitle").textContent = I18N[lang].languagePanelTitle;

    $("rightTitle").textContent = I18N[lang].next4days;

    $("phTitle").textContent = I18N[lang].placeholderTitle;
    $("phSub").textContent = I18N[lang].placeholderSub;

    $("sunTimeTitle").textContent = I18N[lang].sunTime;
    $("localTimeLabel").textContent = I18N[lang].localTime;
    $("sunriseLabel").textContent = I18N[lang].sunrise;
    $("sunsetLabel").textContent = I18N[lang].sunset;
    $("dayLenLabel").textContent = I18N[lang].dayLen;

    $("toggleActual").textContent = I18N[lang].actual;
    $("toggleFeels").textContent = I18N[lang].feels;

    const st = $("statusText").textContent.trim();
    if (st && ["Ready","–ì–æ—Ç–æ–≤–æ","Hazƒ±r","Gotowe"].includes(st)) $("statusText").textContent = I18N[lang].ready;
  }

  // =========================
  // MENU
  // =========================
  const menuBtn = $("menuBtn");
  const menu = $("menu");
  const menuOverlay = $("menuOverlay");

  const menuMain = $("menuMain");
  const menuContactsPanel = $("menuContactsPanel");
  const menuLanguagePanel = $("menuLanguagePanel");

  function activate(panelEl){
    [menuMain, menuContactsPanel, menuLanguagePanel].forEach(p => p.classList.remove("is-active"));
    panelEl.classList.add("is-active");
  }
  function openMenu(){
    menu.classList.add("show");
    menuOverlay.classList.add("show");
    activate(menuMain);
  }
  function closeMenu(){
    menu.classList.remove("show");
    menuOverlay.classList.remove("show");
    activate(menuMain);
  }

  menuBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    if(menu.classList.contains("show")) closeMenu();
    else openMenu();
  });

  menu.addEventListener("click", (e) => e.stopPropagation());
  menuOverlay.addEventListener("click", () => closeMenu());
  document.addEventListener("click", () => closeMenu());

  $("menuLanguage").addEventListener("click", () => activate(menuLanguagePanel));
  $("menuContacts").addEventListener("click", () => activate(menuContactsPanel));

  $("backToMenu1").addEventListener("click", () => activate(menuMain));
  $("backToMenu2").addEventListener("click", () => activate(menuMain));

  menuLanguagePanel.addEventListener("click", (e) => {
    const item = e.target.closest(".menu-item[data-lang]");
    if(!item) return;
    const lang = item.getAttribute("data-lang");
    localStorage.setItem("gw_lang", lang);
    location.reload();
  });

  $("openEmail").addEventListener("click", () => { window.location.href = "mailto:kkaraev1@stu.vistula.edu.pl"; });
  $("openInsta").addEventListener("click", () => { window.open("https://www.instagram.com/grkamran/", "_blank", "noopener,noreferrer"); });

  // =========================
  // WEATHER
  // =========================
  const statusEl = $("status");
  const statusText = $("statusText");

  function setStatus(text, mode="ready"){
    statusText.textContent = text;
    statusEl.classList.toggle("loading", mode === "loading");
    statusText.classList.toggle("err", mode === "error");
  }

  function nowTime(){
    return new Date().toLocaleTimeString(localeForLang(getLang()), {hour:"2-digit", minute:"2-digit"});
  }
  function fmtLocalClockFromOffset(offsetSeconds){
    const nowUtcMs = Date.now();
    const localMs = nowUtcMs + (offsetSeconds * 1000);
    const d = new Date(localMs);
    return d.toLocaleTimeString(localeForLang(getLang()), {hour:"2-digit", minute:"2-digit"});
  }

  const map = L.map("map", { zoomControl:true, preferCanvas:true, minZoom: 2 }).setView([20,10], 2);
  const worldBounds = L.latLngBounds(L.latLng(-85, -180), L.latLng(85, 180));
  map.setMaxBounds(worldBounds);
  map.on("drag", () => map.panInsideBounds(worldBounds, { animate:false }));

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 19, attribution: '&copy; OpenStreetMap' }).addTo(map);

  let pinMarker = null;

  function makePinCard(minT, maxT, desc, hum, wind){
    return `
      <div class="pin-card" style="width: 180px; text-align:left; padding:12px 12px 12px;">
        <div style="font-weight:950; font-size:22px; letter-spacing:.2px;">
          ${Math.round(minT)}¬∞/${Math.round(maxT)}¬∞
        </div>
        <div style="margin-top:6px; font-size:12px; color:rgba(255,255,255,.78);">
          ${desc || "‚Äî"}
        </div>
        <div style="margin-top:8px; font-size:12px; color:rgba(255,255,255,.78);">
          ${t("hum")} ${hum ?? "‚Äî"}%
        </div>
        <div style="margin-top:4px; font-size:12px; color:rgba(255,255,255,.78);">
          ${t("wind")} ${wind ?? "‚Äî"} ${t("ms")}
        </div>
      </div>
    `;
  }

  function setPin(lat, lon, minT, maxT, desc, hum, wind){
    const icon = L.divIcon({
      className: "",
      html: makePinCard(minT, maxT, desc, hum, wind),
      iconSize: [180, 118],
      iconAnchor: [90, 118]
    });
    if (pinMarker) map.removeLayer(pinMarker);
    pinMarker = L.marker([lat, lon], { icon }).addTo(map);
  }

  async function apiSearch(city){
    const lang = getLang();
    const res = await fetch(`/api/search/?city=${encodeURIComponent(city)}&lang=${encodeURIComponent(lang)}`);
    const data = await res.json().catch(() => ({}));
    if(!res.ok){
      const msg = data?.error || "Request failed";
      throw new Error(msg);
    }
    return data;
  }

  async function apiSuggest(q){
    const lang = getLang();
    const res = await fetch(`/api/suggest/?q=${encodeURIComponent(q)}&lang=${encodeURIComponent(lang)}&limit=7`);
    const data = await res.json().catch(() => ({}));
    if(!res.ok) return { suggestions: [] };
    return data;
  }

  function dayLabel(iso){
    const d = new Date(iso + "T00:00:00");
    return d.toLocaleDateString(localeForLang(getLang()), { weekday:"short", month:"short", day:"numeric" });
  }

  function iconFor(desc=""){
    const txt = (desc || "").toLowerCase();
    if (txt.includes("rain")) return "üåßÔ∏è";
    if (txt.includes("cloud")) return "‚òÅÔ∏è";
    if (txt.includes("snow")) return "üå®Ô∏è";
    if (txt.includes("storm") || txt.includes("thunder")) return "‚õàÔ∏è";
    if (txt.includes("clear")) return "‚òÄÔ∏è";
    return "‚õÖ";
  }

  // =========================
  // ‚úÖ DAY SHEET: make 00:00 -> 23:00
  // =========================
  const daySheet = $("daySheet");
  const daySheetOverlay = $("daySheetOverlay");
  const daySheetClose = $("daySheetClose");
  const daySheetTitle = $("daySheetTitle");
  const daySheetSub = $("daySheetSub");
  const hourRow = $("hourRow");

  const toggleActual = $("toggleActual");
  const toggleFeels = $("toggleFeels");
  const chartCanvas = $("dayChart");
  const ctx = chartCanvas.getContext("2d");

  let lastSearchData = null;
  let currentSheetDate = null;
  let chartMode = "temp"; // "temp" | "feels"

  function openDaySheet(){
    daySheet.classList.add("show");
    daySheetOverlay.classList.add("show");
    daySheet.setAttribute("aria-hidden", "false");
  }
  function closeDaySheet(){
    daySheet.classList.remove("show");
    daySheetOverlay.classList.remove("show");
    daySheet.setAttribute("aria-hidden", "true");
  }
  daySheetOverlay.addEventListener("click", closeDaySheet);
  daySheetClose.addEventListener("click", closeDaySheet);
  document.addEventListener("keydown", (e) => { if(e.key === "Escape") closeDaySheet(); });

  function setToggle(mode){
    chartMode = mode;
    toggleActual.classList.toggle("is-active", mode === "temp");
    toggleFeels.classList.toggle("is-active", mode === "feels");
    if(currentSheetDate) renderDayDetails(currentSheetDate);
  }
  toggleActual.addEventListener("click", () => setToggle("temp"));
  toggleFeels.addEventListener("click", () => setToggle("feels"));

  function safeNum(x, fallback=0){
    const n = Number(x);
    return Number.isFinite(n) ? n : fallback;
  }

  function pad2(n){ return String(n).padStart(2,"0"); }

  // ‚úÖ Make hourly timeline 24 points (00..23), using nearest previous value.
  function buildFullDaySeries(arr){
    // arr: [{time:"04:00", temp, feels_like, humidity, wind_speed, pop, description}, ...]
    // return: 24 objects (00..23)
    const byHour = {};
    (arr || []).forEach(x => {
      const hh = parseInt(String(x.time || "0").slice(0,2), 10);
      if(Number.isFinite(hh)) byHour[hh] = x;
    });

    // If day begins without data, use first available point as initial seed
    let first = null;
    for(let h=0; h<24; h++){
      if(byHour[h]) { first = byHour[h]; break; }
    }
    if(!first) return []; // no data at all

    const out = [];
    let last = first;

    for(let h=0; h<24; h++){
      if(byHour[h]) last = byHour[h];

      // clone + force time = HH:00
      out.push({
        ...last,
        time: `${pad2(h)}:00`,
      });
    }
    return out;
  }

  function drawChart(points, labels){
    const dpr = window.devicePixelRatio || 1;
    const w = chartCanvas.clientWidth ? chartCanvas.clientWidth : 760;
    const h = 260;

    chartCanvas.width = Math.floor(w * dpr);
    chartCanvas.height = Math.floor(h * dpr);
    chartCanvas.style.width = w + "px";
    chartCanvas.style.height = h + "px";
    ctx.setTransform(dpr,0,0,dpr,0,0);

    ctx.clearRect(0,0,w,h);

    const padL = 44, padR = 18, padT = 18, padB = 34;
    const plotW = w - padL - padR;
    const plotH = h - padT - padB;

    let minV = Math.min(...points);
    let maxV = Math.max(...points);
    if(!Number.isFinite(minV) || !Number.isFinite(maxV)){ minV = 0; maxV = 1; }
    if (maxV - minV < 2){ maxV += 1; minV -= 1; }

    // grid
    ctx.strokeStyle = "rgba(255,255,255,.10)";
    ctx.lineWidth = 1;
    for(let i=0;i<=4;i++){
      const y = padT + (plotH*(i/4));
      ctx.beginPath();
      ctx.moveTo(padL, y);
      ctx.lineTo(w-padR, y);
      ctx.stroke();
    }

    const toX = (i) => padL + (plotW * (i / Math.max(1, points.length-1)));
    const toY = (v) => {
      const t = (v - minV) / (maxV - minV);
      return padT + (plotH * (1 - t));
    };

    // line
    ctx.lineWidth = 3;
    ctx.strokeStyle = "rgba(120,70,255,.95)";
    ctx.beginPath();
    points.forEach((v,i)=>{
      const x = toX(i);
      const y = toY(v);
      if(i===0) ctx.moveTo(x,y);
      else ctx.lineTo(x,y);
    });
    ctx.stroke();

    // fill
    ctx.lineTo(toX(points.length-1), padT+plotH);
    ctx.lineTo(toX(0), padT+plotH);
    ctx.closePath();
    const grad = ctx.createLinearGradient(0,padT,0,padT+plotH);
    grad.addColorStop(0,"rgba(6,182,212,.30)");
    grad.addColorStop(1,"rgba(124,58,237,.12)");
    ctx.fillStyle = grad;
    ctx.fill();

    // dots: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ –≤—Å–µ 24 —Ç–æ—á–∫–∏, –∞ —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ)
    ctx.fillStyle = "rgba(255,255,255,.92)";
    for(let i=0;i<points.length;i+=2){
      const x = toX(i), y = toY(points[i]);
      ctx.beginPath();
      ctx.arc(x,y,3.5,0,Math.PI*2);
      ctx.fill();
    }

    // y labels
    ctx.fillStyle = "rgba(255,255,255,.65)";
    ctx.font = "12px ui-monospace, monospace";
    ctx.fillText(`${Math.round(maxV)}¬∞`, 8, padT+6);
    ctx.fillText(`${Math.round(minV)}¬∞`, 8, padT+plotH);

    // x labels: 00, 06, 12, 18, 23
    ctx.fillStyle = "rgba(255,255,255,.55)";
    ctx.font = "11px ui-monospace, monospace";
    const pick = [0,6,12,18,23];
    pick.forEach(i=>{
      const x = toX(i);
      const txt = labels[i] || "";
      ctx.fillText(txt, x-14, padT+plotH+22);
    });
  }

  function renderDayDetails(dateIso){
    if(!lastSearchData) return;

    const hourlyByDate = lastSearchData.hourly_by_date || {};
    const arrRaw = hourlyByDate[dateIso] || [];
    const arr = buildFullDaySeries(arrRaw);

    if(!arr.length){
      daySheetTitle.textContent = dayLabel(dateIso);
      daySheetSub.textContent = "‚Äî";
      hourRow.innerHTML = `<div class="hour-card" style="width:100%; text-align:center;">
        <b>${t("noForecastTitle")}</b>
        <div class="mini">${t("tryAnotherCity")}</div>
      </div>`;
      drawChart([0,0,0],[ "‚Äî","‚Äî","‚Äî" ]);
      return;
    }

    const cityName = lastSearchData?.current?.city || "‚Äî";
    const country = lastSearchData?.current?.country || "";
    daySheetTitle.textContent = dayLabel(dateIso);
    daySheetSub.textContent = `${cityName}${country ? ", " + country : ""} ‚Ä¢ ${t("details")}`;

    const labels = arr.map(x => x.time);
    const points = arr.map(x => chartMode === "feels" ? safeNum(x.feels_like) : safeNum(x.temp));
    drawChart(points, labels);

    // Cards: 24 cards can be too many ‚Üí –ø–æ–∫–∞–∂–µ–º 8 –∫–ª—é—á–µ–≤—ã—Ö —á–∞—Å–æ–≤: 00,03,06,09,12,15,18,21
    const pickHours = new Set([0,3,6,9,12,15,18,21]);
    const showArr = arr.filter(x => pickHours.has(parseInt(x.time.slice(0,2),10)));

    hourRow.innerHTML = showArr.map(x => {
      const popPct = Math.round(safeNum(x.pop,0) * 100);
      const tempShown = Math.round(chartMode === "feels" ? safeNum(x.feels_like) : safeNum(x.temp));
      return `
        <div class="hour-card">
          <b>${x.time}</b>
          <div class="mini">
            ${iconFor(x.description)} ${tempShown}¬∞<br>
            ${x.description || "‚Äî"}<br>
            ${t("hum")} ${safeNum(x.humidity)}% ‚Ä¢ ${t("wind")} ${safeNum(x.wind_speed).toFixed(1)} ${t("ms")}<br>
            ${t("pop")} ${popPct}%
          </div>
        </div>
      `;
    }).join("");
  }

  function openDay(dateIso){
    currentSheetDate = dateIso;
    setToggle(chartMode);
    renderDayDetails(dateIso);
    openDaySheet();
  }

  // =========================
  // Next 4 days clickable
  // =========================
  function renderNext4Days(daily){
    const list = $("daylist");
    list.innerHTML = "";

    const next = (daily || []).slice(1, 5);

    if (!next.length){
      const el = document.createElement("div");
      el.className = "citycard card-appear";
      el.style.animationDelay = "0ms";
      el.innerHTML = `
        <div class="city-left">
          <div class="ico">‚õÖ</div>
          <div class="city-meta">
            <b>${t("noForecastTitle")}</b>
            <span>${t("tryAnotherCity")}</span>
          </div>
        </div>
        <div class="city-temp">‚Äî</div>
      `;
      list.appendChild(el);
      return;
    }

    next.forEach((d, i) => {
      const el = document.createElement("div");
      el.className = "citycard card-appear is-clickable";
      el.style.animationDelay = (i * 90) + "ms";
      el.setAttribute("data-date", d.date);

      el.innerHTML = `
        <div class="city-left">
          <div class="ico">${iconFor(d.description)}</div>
          <div class="city-meta">
            <b>${dayLabel(d.date)}</b>
            <span>${(d.description || "‚Äî")} ‚Ä¢ ${t("hum")} ${d.humidity}% ‚Ä¢ ${t("wind")} ${d.wind_speed} ${t("ms")}</span>
          </div>
        </div>
        <div class="city-temp">${Math.round(d.min)}¬∞/${Math.round(d.max)}¬∞</div>
      `;

      el.addEventListener("click", () => openDay(d.date));
      list.appendChild(el);
    });
  }

  function renderSunPanel(c, sun){
    $("updated").textContent = `${t("updated")} ${nowTime()}`;
    const offset = Number(c.timezone || 0);
    $("localtime").textContent = fmtLocalClockFromOffset(offset);
    $("sunrise").textContent = (sun && sun.sunrise) ? sun.sunrise : "‚Äî";
    $("sunset").textContent  = (sun && sun.sunset)  ? sun.sunset  : "‚Äî";
    $("daylen").textContent  = (sun && sun.day_length) ? sun.day_length : "‚Äî";
  }

  async function search(city){
    if(!city){
      setStatus(t("typeCityName"));
      return;
    }

    try{
      setStatus(t("searching"), "loading");
      const data = await apiSearch(city);
      lastSearchData = data;

      const c = data.current;

      setPin(c.lat, c.lon, c.temp_min, c.temp_max, c.description, c.humidity, c.wind_speed);
      map.flyTo([c.lat, c.lon], 6, { animate:true, duration: 1.2 });

      renderNext4Days(data.daily);
      renderSunPanel(c, data.sun || null);

      $("rtag").textContent = `${c.city}, ${c.country}`;
      setStatus(t("done"));
    }catch(e){
      console.error(e);
      setStatus(t("errorPrefix") + (e?.message || e), "error");
    }
  }

  // AUTOCOMPLETE
  const input = $("q");
  const box = $("suggestBox");
  let debounceTimer = null;
  let currentItems = [];

  function closeSuggest(){
    box.style.display = "none";
    box.innerHTML = "";
    currentItems = [];
  }

  function escapeHtml(s){
    return String(s ?? "").replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[c]));
  }

  function renderSuggest(items){
    currentItems = items || [];
    if(!currentItems.length){
      box.innerHTML = `<div class="sug-empty">${t("noSuggestions")}</div>`;
      box.style.display = "block";
      return;
    }

    box.innerHTML = currentItems.map((it, idx) => {
      const subtitle = it.subtitle ? it.subtitle : "";
      return `
        <div class="sug-item" data-idx="${idx}">
          <div class="sug-ico">üìç</div>
          <div class="sug-meta">
            <b>${escapeHtml(it.title)}</b>
            <span>${escapeHtml(subtitle)}</span>
          </div>
        </div>
      `;
    }).join("");

    box.style.display = "block";
  }

  async function doSuggest(){
    const q = input.value.trim();
    if(q.length < 2){ closeSuggest(); return; }
    const data = await apiSuggest(q);
    renderSuggest(data.suggestions || []);
  }

  input.addEventListener("input", () => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(doSuggest, 250);
  });

  box.addEventListener("click", (e) => {
    const item = e.target.closest(".sug-item");
    if(!item) return;
    const idx = Number(item.getAttribute("data-idx"));
    const it = currentItems[idx];
    if(!it) return;

    input.value = it.title;
    closeSuggest();
    search(it.title);
  });

  // One Enter handler
  input.addEventListener("keydown", (e) => {
    if(e.key === "Escape"){ closeSuggest(); return; }
    if(e.key === "Enter"){
      e.preventDefault();
      const q = input.value.trim();
      closeSuggest();
      if(q) search(q);
    }
  });

  document.addEventListener("click", (e) => {
    const wrap = input.parentElement;
    if(!wrap.contains(e.target)) closeSuggest();
  });

  // close sheet handlers
  daySheetOverlay.addEventListener("click", closeDaySheet);
  daySheetClose.addEventListener("click", closeDaySheet);

  // INIT
  applyLang(getLang());
  setStatus(t("ready"));
})();
</script>
{% endblock %}
